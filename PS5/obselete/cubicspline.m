function [b1 b2 b3 b4] = cubicspline(x,y)

m = length(x);

X1 = zeros(2*(m-1),4*(m-1));

for i=2:m
    X1(i-1,4*(i-1)-3:4*(i-1))= [1 x(i) x(i)^2 x(i)^3];
end

for i=1:m-1
    X1((m-1)+i,4*(i)-3:4*(i)) = [1 x(i) x(i)^2 x(i)^3];
end

X2 = zeros(m-2,4*(m-1));

for i=2:m-1
    X2(i-1,4*(i-1)-3:4*(i-1)+4) = [0 1 2*x(i) 3*x(i)^2 0 -1 -2*x(i) -3*x(i)^2];
end

X3 = zeros(m-2,4*(m-1));
for i=2:m-1
    X3(i-1,4*(i-1)-3:4*(i-1)+4) = [0 0 2 6*x(i) 0 0 -2 -6*x(i)];
end

X4 = zeros(2,4*(m-1));
%X4(1,1:4)= [0 1 2*x(1) 3*x(1)^2];
%X4(2,4*(m-1)-3:4*(m-1))= [0 1 2*x(m) 3*x(m)^2];
X4(1,1:4)= [0 0 2 6*x(1)];
X4(2,4*(m-1)-3:4*(m-1))= [0 0 2 6*x(m)];

X =  [X1;X2;X3;X4];

Y = [y(2:m)';
    y(1:(m-1))';
    zeros(size(X2,1),1);
    zeros(size(X3,1),1);
    0;0]%(y(2)-y(1))/(x(2)-x(1));
    %(y(m)-y(m-1))/(x(m)-x(m-1))];

b = X\Y;
b = reshape(b,4,m-1);
b1 = b(:,1)';
b2 = b(:,2)';
b3 = b(:,3)';
b4 = b(:,4)';